import{_ as me}from"./index.vue_vue_type_script_setup_true_lang-CTmng4zF.js";import{w as ge,x as ve,u as ke}from"./index-CI_QF3t5.js";import{ba as he,bb as ye,a6 as be,R as xe,bc as Ce,b3 as we,aY as E,I as Ie,B as Se,a1 as Ae,b1 as ze,a2 as Oe,a9 as Ue,aa as Ne,ah as Le,H as De,S as Me,F as $e,a0 as Be,a7 as Re,M as Ve,D as je,bd as He,be as Pe,aj as Fe,ab as Te}from"./antd-B7NuRx5N.js";import{d as Ee,s as M,r as $,f,c as G,w as Ge,o as Je,a4 as m,ab as S,ac as t,k as e,u as a,G as i,ag as B,af as J,H as R,a2 as K,a7 as Ke}from"./vue-BG1emjmP.js";import"./context-BMeipo-2.js";async function Qe(C){return ge("/list/consult-list",C)}async function Ye(C){return ve(`/list/${C}`)}const qe={key:0,flex:"","gap-2":""},We=["onClick"],Xe={key:1,"gap-2":""},ot=Ee({__name:"table-list",setup(C){const Q={0:"关闭",1:"运行中",2:"上线",3:"错误"},V=ke(),A=M([{title:"#",dataIndex:"id"},{title:"规则名称",dataIndex:"name"},{title:"描述",dataIndex:"desc"},{title:"服务调用次数",dataIndex:"callNo"},{title:"状态",dataIndex:"status",width:100},{title:"上次调度时间",dataIndex:"updatedAt",width:200},{title:"操作",dataIndex:"action",width:200}]),c=M(!1),_=$({pageSize:10,pageSizeOptions:["10","20","30","40"],current:1,total:100,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`总数据位：${o}`,onChange(o,n){_.pageSize=n,_.current=o,k()}}),j=M([]),s=$({name:void 0,callNo:void 0,desc:void 0,status:void 0,updatedAt:void 0}),g=f(["large"]),Y=f([{key:"large",label:"默认",title:"默认"},{key:"middle",label:"中等",title:"中等"},{key:"small",label:"紧凑",title:"紧凑"}]),v=f(!1),q=G(()=>A.value.map(o=>o.dataIndex==="action"?{label:o.title,value:o.dataIndex,disabled:!0}:{label:o.title,value:o.dataIndex})),z=f(!1),d=G(()=>A.value.map(o=>o.dataIndex)),u=$({indeterminate:!1,checkAll:!0,checkList:d.value});async function k(){if(!c.value){c.value=!0;try{const{data:o}=await Qe({...s,current:_.current,pageSize:_.pageSize});j.value=o??[]}catch(o){console.log(o)}finally{c.value=!1}}}async function O(){_.current=1,await k()}async function W(){s.name=void 0,s.desc=void 0,await k()}async function X(o){const n=V.loading("删除中......");try{(await Ye(o.id)).code===200&&await k(),V.success("删除成功")}catch(r){console.log(r)}finally{n()}}function Z(){v.value=!1,E.destroyAll(),O()}const ee=o=>{g.value[0]=o.key};function w(o){return A.value.filter(n=>!!o.includes(n.dataIndex))}const h=f(w(d.value));function te(o){Object.assign(u,{checkList:o.target.checked?d.value:[],indeterminate:!0}),h.value=o.target.checked?w(d.value):h.value.filter(n=>n.dataIndex==="action")}Ge(()=>u.checkList,o=>{u.indeterminate=!!o.length&&o.length<d.value.length,u.checkAll=o.length===d.value.length});function ae(){u.checkList=d.value,h.value=w(d.value)}function ne(o){const n=w(o);h.value=n}Je(()=>{k()});const y=f(!1);return(o,n)=>{const r=Ie,b=Se,p=Ae,le=ze,U=Oe,I=Ue,oe=Ne,se=Le,x=De,N=Me,ue=$e,L=Be,D=Re,ie=Ve,H=je,de=He,ce=Pe,_e=Fe,re=Te,pe=E,fe=me;return m(),S(fe,null,{default:t(()=>[e(L,{"mb-4":""},{default:t(()=>[e(ue,{"label-col":{span:7},model:a(s)},{default:t(()=>[e(U,{gutter:[15,0]},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(b,{name:"name",label:"规则名称"},{default:t(()=>[e(r,{value:a(s).name,"onUpdate:value":n[0]||(n[0]=l=>a(s).name=l)},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(b,{name:"desc",label:"描述"},{default:t(()=>[e(r,{value:a(s).desc,"onUpdate:value":n[1]||(n[1]=l=>a(s).desc=l)},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(b,{name:"updatedAt",label:"上次调用时间"},{default:t(()=>[e(le,{value:a(s).updatedAt,"onUpdate:value":n[2]||(n[2]=l=>a(s).updatedAt=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(y)?(m(),S(U,{key:0,gutter:[15,0]},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(b,{name:"status",label:"状态"},{default:t(()=>[e(oe,{value:a(s).status,"onUpdate:value":n[3]||(n[3]=l=>a(s).status=l)},{default:t(()=>[e(I,{value:"0"},{default:t(()=>[i(" 关闭 ")]),_:1}),e(I,{value:"1"},{default:t(()=>[i(" 运行中 ")]),_:1}),e(I,{value:"2"},{default:t(()=>[i(" 上线 ")]),_:1}),e(I,{value:"3"},{default:t(()=>[i(" 错误 ")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(b,{name:"callNo",label:"服务调用次数"},{default:t(()=>[e(se,{value:a(s).callNo,"onUpdate:value":n[4]||(n[4]=l=>a(s).callNo=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})):B("",!0),e(U,{span:24,style:{"text-align":"right"}},{default:t(()=>[e(p,{span:24},{default:t(()=>[e(N,{flex:"","justify-end":"","w-full":""},{default:t(()=>[e(x,{loading:a(c),type:"primary",onClick:O},{default:t(()=>[i(" 查询 ")]),_:1},8,["loading"]),e(x,{loading:a(c),onClick:W},{default:t(()=>[i(" 重置 ")]),_:1},8,["loading"]),e(x,{type:"link",onClick:n[5]||(n[5]=l=>y.value=!a(y))},{default:t(()=>[i(J(a(y)?"收起":"展开")+" ",1),a(y)?(m(),S(a(he),{key:0})):(m(),S(a(ye),{key:1}))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(L,{title:"查询表格"},{extra:t(()=>[e(N,{size:"middle"},{default:t(()=>[e(x,{type:"primary",onClick:n[6]||(n[6]=()=>v.value=!0)},{icon:t(()=>[e(a(be))]),default:t(()=>[i(" 新增 ")]),_:1}),e(D,{title:"刷新"},{default:t(()=>[e(a(xe),{onClick:O})]),_:1}),e(D,{title:"密度"},{default:t(()=>[e(H,{trigger:"click"},{overlay:t(()=>[e(ie,{"selected-keys":a(g),"onUpdate:selectedKeys":n[7]||(n[7]=l=>R(g)?g.value=l:null),items:a(Y),onClick:ee},null,8,["selected-keys","items"])]),default:t(()=>[e(a(Ce))]),_:1})]),_:1}),e(D,{title:"列设置"},{default:t(()=>[e(H,{open:a(z),"onUpdate:open":n[10]||(n[10]=l=>R(z)?z.value=l:null),trigger:"click"},{overlay:t(()=>[e(L,null,{title:t(()=>[e(de,{checked:a(u).checkAll,"onUpdate:checked":n[8]||(n[8]=l=>a(u).checkAll=l),indeterminate:a(u).indeterminate,onChange:te},{default:t(()=>[i(" 列选择 ")]),_:1},8,["checked","indeterminate"])]),extra:t(()=>[e(x,{type:"link",onClick:ae},{default:t(()=>[i(" 重置 ")]),_:1})]),default:t(()=>[e(ce,{value:a(u).checkList,"onUpdate:value":n[9]||(n[9]=l=>a(u).checkList=l),options:a(q),style:{display:"flex","flex-direction":"column"},onChange:ne},null,8,["value","options"])]),_:1})]),default:t(()=>[e(a(we))]),_:1},8,["open"])]),_:1})]),_:1})]),default:t(()=>[e(_e,{loading:a(c),columns:a(h),"data-source":a(j),pagination:a(_),size:a(g)[0]},{bodyCell:t(l=>{var P,F,T;return[((P=l==null?void 0:l.column)==null?void 0:P.dataIndex)==="action"?(m(),K("div",qe,[Ke("a",{"c-error":"",onClick:Ze=>X(l==null?void 0:l.record)}," 删除 ",8,We)])):B("",!0),((F=l==null?void 0:l.column)==null?void 0:F.dataIndex)==="status"?(m(),K("div",Xe,J(Q[(T=l==null?void 0:l.record)==null?void 0:T.status]),1)):B("",!0)]}),_:1},8,["loading","columns","data-source","pagination","size"])]),_:1}),e(pe,{open:a(v),"onUpdate:open":n[11]||(n[11]=l=>R(v)?v.value=l:null),title:"新建规则",width:"400px",onOk:Z},{default:t(()=>[e(N,{direction:"vertical",size:"large",class:"w-full"},{default:t(()=>[e(r,{placeholder:"请输入"}),e(re,{placeholder:"请输入"})]),_:1})]),_:1},8,["open"])]),_:1})}}});export{ot as default};
